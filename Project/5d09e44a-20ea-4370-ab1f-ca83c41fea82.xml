{"CLs":[{"__type":"IST","EID":"61c3f420-bd60-4528-9456-b618cc2cdac2","H":86,"TXT":"MessageLength:=LEN(Message);\u000d\u000aStringToAry(Message,MessageAsByte[0]);\u000d\u000a","W":718}],"LRI":1,"RRI":2,"VLs":[]}
{"CLs":[{"__type":"LD","Var":"Enable"},{"__type":"IST","EID":"8d17bb29-a08d-4a66-b1c1-2e06a2eff9a1","H":723.99999999999989,"Ix":1,"TXT":"\/\/ Start sequence when Trigger changes to TRUE. \u000d\u000aIF ( (Trigger=TRUE) AND (DoTCP=FALSE) AND (Setup.EIP_EtnOnlineSta=TRUE) ) THEN \u000d\u000a   DoTCP :=TRUE; \u000d\u000a   Clear(ReplyAsBytes);\u000d\u000a   Stage :=INT#1; \u000d\u000a   TCPConnect(Execute:=FALSE);   \/\/ Initialize instance. \u000d\u000a    TCPClearBuffer(Execute:=FALSE);     \/\/ Initialize instance. \u000d\u000a    TCPStatus(Execute:=FALSE); \/\/ Initialize instance. \u000d\u000a    TCPSend( \u000d\u000a       Execute:=FALSE, \u000d\u000a         SendDat:=MessageAsByte[0]);          \/\/ Dummy \u000d\u000a    TCPReceive(                       \/\/ Initialize instance. \u000d\u000a         Execute:=FALSE, \u000d\u000a         RcvDat :=ReplyAsBytes[0]);           \/\/ Dummy \u000d\u000a    TCPClose(Execute:=FALSE);        \/\/ Initialize instance. \u000d\u000aEND_IF; \u000d\u000a  \u000d\u000a  \u000d\u000aIF (DoTCP=TRUE) THEN \u000d\u000a    CASE Stage OF \u000d\u000a   1 :    \/\/ Request a connection. \u000d\u000a       TCPConnect( \u000d\u000a           Execute   :=TRUE, \u000d\u000a              SrcTcpPort:=Setup.SourcePort,          \/\/ Local TCP port number: Automatically assigned. \u000d\u000a              DstAdr    :=Setup.IP_Address, \/\/ Remote IP address \u000d\u000a              DstTcpPort:=Setup.DestPort,       \/\/ Destination TCP port number \u000d\u000a              Socket     =>TCPSocket); \/\/ Socket \u000d\u000a  \u000d\u000a         IF (TCPConnect.Done=TRUE) THEN \u000d\u000a              Stage:=INT#2;     \/\/ Normal end \u000d\u000a         ELSIF (TCPConnect.Error=TRUE) THEN \u000d\u000a              Stage:=INT#10;    \/\/ Error end \u000d\u000a         END_IF; \u000d\u000a  \u000d\u000a   2 :    \/\/ Clear receive buffer. \u000d\u000a       TCPClearBuffer( \u000d\u000a           Execute:=TRUE, \u000d\u000a           Socket :=TCPSocket);   \/\/ Socket \u000d\u000a  \u000d\u000a       IF (TCPClearBuffer.Done=TRUE) THEN \u000d\u000a           Stage:=INT#3;         \/\/ Normal end \u000d\u000a       ELSIF (TCPClearBuffer.Error=TRUE) THEN \u000d\u000a           Stage:=INT#20;        \/\/ Error end \u000d\u000a       END_IF; \u000d\u000a  \u000d\u000a   3 :    \/\/ Request reading status. \u000d\u000a       TCPStatus( \u000d\u000a           Execute:=TRUE, \u000d\u000a           Socket :=TCPSocket);   \/\/ Socket \u000d\u000a  \u000d\u000a       IF (TCPStatus.Done=TRUE) THEN \u000d\u000a           Stage:=INT#4;         \/\/ Normal end \u000d\u000a       ELSIF (TCPStatus.Error=TRUE) THEN \u000d\u000a           Stage:=INT#30;        \/\/ Error end \u000d\u000a       END_IF; \u000d\u000a  \u000d\u000a   4 :    \/\/ Request sending data \u000d\u000a       TCPSend( \u000d\u000a           Execute:=TRUE, \u000d\u000a           Socket :=TCPSocket,         \/\/ Socket \u000d\u000a           SendDat:=MessageAsByte[0], \/\/ Send data \u000d\u000a           Size   :=MessageLength);       \/\/ Send data size \u000d\u000a  \u000d\u000a       IF (TCPSend.Done=TRUE) THEN \u000d\u000a\u0009\u0009   SendTime:=Get1usCnt();\u000d\u000a           Stage:=INT#5;              \/\/ Normal end \u000d\u000a       ELSIF (TCPSend.Error=TRUE) THEN \u000d\u000a           Stage:=INT#40;             \/\/ Error end \u000d\u000a       END_IF; \u000d\u000a  \u000d\u000a   5 :    \/\/ Request receiving data \u000d\u000a       TCPReceive( \u000d\u000a           Execute:=TRUE, \u000d\u000a           Socket :=TCPSocket,         \/\/ Socket \u000d\u000a           TimeOut:=Setup.ReceiveTimeOut\/100,           \/\/ Timeout time \u000d\u000a           Size   :=UINT#256,        \/\/ Receive data size \u000d\u000a           RcvDat :=ReplyAsBytes[0]); \/\/ Receive data \u000d\u000a  \u000d\u000a       IF (TCPReceive.Done=TRUE) THEN \u000d\u000a           Stage:=INT#6;              \/\/ Normal end \u000d\u000a\u0009\u0009   ResponseTime:=Get1usCnt()-SendTime;\u000d\u000a       ELSIF (TCPReceive.Error=TRUE) THEN \u000d\u000a           Stage:=INT#50;             \/\/ Error end \u000d\u000a       END_IF; \u000d\u000a  \u000d\u000a   6 :    \/\/ Request closing. \u000d\u000a       TCPClose( \u000d\u000a           Execute:=TRUE, \u000d\u000a           Socket :=TCPSocket);        \/\/ Socket \u000d\u000a  \u000d\u000a       IF (TCPClose.Done=TRUE) THEN \u000d\u000a           Stage:=INT#0;              \/\/ Normal end \u000d\u000a       ELSIF (TCPClose.Error=TRUE) THEN \u000d\u000a           Stage:=INT#60;             \/\/ Error end \u000d\u000a       END_IF; \u000d\u000a  \u000d\u000a   0 :    \/\/ Normal end \u000d\u000a       DoTCP   :=FALSE;  \u000d\u000a  \u000d\u000a   ELSE   \/\/ Interrupted by error. \u000d\u000a       DoTCP   :=FALSE;  \u000d\u000a\u0009   TCPClose( \u000d\u000a           Execute:=TRUE, \u000d\u000a           Socket :=TCPSocket);        \/\/ Socket \u000d\u000a   END_CASE; \u000d\u000a  \u000d\u000aEND_IF; \u000d\u000a","W":793,"X":1}],"LRI":2,"RRI":3,"VLs":[]}
{"CLs":[{"__type":"LD","Var":"TCPConnect.Busy"},{"__type":"LD","Ix":1,"Var":"TCPClose.Busy","Y":1},{"__type":"LD","Ix":2,"Var":"TCPSend.Busy","Y":2},{"__type":"LD","Ix":3,"Var":"TCPAccept.Busy","Y":3},{"__type":"LD","Ix":4,"Var":"TCPStatus.Busy","Y":4},{"__type":"LD","Ix":5,"Var":"TCPClearBuffer.Busy","Y":5},{"__type":"LD","Ix":6,"Var":"TCPReceive.Busy","Y":6},{"__type":"LD","Ix":7,"Var":"Enable","X":1},{"__type":"ST","Ix":8,"Var":"Busy","X":2}],"LRI":9,"RRI":10,"VLs":[{"Ix":11,"X":1},{"Ix":11,"X":1,"Y":1},{"Ix":11,"X":1,"Y":2},{"Ix":11,"X":1,"Y":3},{"Ix":11,"X":1,"Y":4},{"Ix":11,"X":1,"Y":5}]}
{"CLs":[{"__type":"LD","Var":"TCPConnect.Error"},{"__type":"LD","Ix":1,"Var":"TCPClose.Error","Y":1},{"__type":"LD","Ix":2,"Var":"TCPSend.Error","Y":2},{"__type":"LD","Ix":3,"Var":"TCPAccept.Error","Y":3},{"__type":"LD","Ix":4,"Var":"TCPStatus.Error","Y":4},{"__type":"LD","Ix":5,"Var":"TCPClearBuffer.Error","Y":5},{"__type":"LD","Ix":6,"Var":"TCPReceive.Error","Y":6},{"__type":"LD","Ix":7,"Var":"Enable","X":1},{"__type":"ST","Ix":8,"Var":"Error","X":2}],"LRI":9,"RRI":10,"VLs":[{"Ix":11,"X":1},{"Ix":11,"X":1,"Y":1},{"Ix":11,"X":1,"Y":2},{"Ix":11,"X":1,"Y":3},{"Ix":11,"X":1,"Y":4},{"Ix":11,"X":1,"Y":5}]}
{"CLs":[{"__type":"LD","Ix":1,"Var":"Enable"},{"__type":"LD","Var":"TCPReceive.Done","X":1},{"__type":"ST","Ix":2,"Var":"Done","X":2}],"LRI":3,"RRI":4,"VLs":[]}
{"CLs":[{"__type":"LD","Var":"Enable"},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In","Ix":27,"Type":"ANY","Var":"WORD#0"}],"Ix":44,"Name":"MOVE","Out":[{"__type":"PF","Arg":"ENO"},{"__type":"PRM","Arg":"Out","Ix":28,"Type":"ANY","Var":"ErrorID"}],"X":1},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In1","Ix":1,"Type":"ANY_ELEMENTARY, ENUM","Var":"TCPConnect.ErrorID"},{"__type":"PRM","Arg":"In2","Ix":2,"Type":"ANY_ELEMENTARY, ENUM","Var":"WORD#0"}],"Ix":31,"Name":"<>","Out":[{"__type":"PF","Arg":""}],"X":1,"Y":1},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In","Ix":29,"Type":"ANY","Var":"TCPConnect.ErrorID"}],"Ix":45,"Name":"MOVE","Out":[{"__type":"PF","Arg":"ENO"},{"__type":"PRM","Arg":"Out","Ix":30,"Type":"ANY","Var":"ErrorID"}],"X":2,"Y":1},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In1","Ix":3,"Type":"ANY_ELEMENTARY, ENUM","Var":"TCPClose.ErrorID"},{"__type":"PRM","Arg":"In2","Ix":4,"Type":"ANY_ELEMENTARY, ENUM","Var":"WORD#0"}],"Ix":32,"Name":"<>","Out":[{"__type":"PF","Arg":""}],"X":1,"Y":2},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In","Ix":5,"Type":"ANY","Var":"TCPClose.ErrorID"}],"Ix":33,"Name":"MOVE","Out":[{"__type":"PF","Arg":"ENO"},{"__type":"PRM","Arg":"Out","Ix":6,"Type":"ANY","Var":"ErrorID"}],"X":2,"Y":2},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In1","Ix":7,"Type":"ANY_ELEMENTARY, ENUM","Var":"TCPSend.ErrorID"},{"__type":"PRM","Arg":"In2","Ix":8,"Type":"ANY_ELEMENTARY, ENUM","Var":"WORD#0"}],"Ix":34,"Name":"<>","Out":[{"__type":"PF","Arg":""}],"X":1,"Y":3},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In","Ix":9,"Type":"ANY","Var":"TCPSend.ErrorID"}],"Ix":35,"Name":"MOVE","Out":[{"__type":"PF","Arg":"ENO"},{"__type":"PRM","Arg":"Out","Ix":10,"Type":"ANY","Var":"ErrorID"}],"X":2,"Y":3},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In1","Ix":11,"Type":"ANY_ELEMENTARY, ENUM","Var":"TCPAccept.ErrorID"},{"__type":"PRM","Arg":"In2","Ix":12,"Type":"ANY_ELEMENTARY, ENUM","Var":"WORD#0"}],"Ix":36,"Name":"<>","Out":[{"__type":"PF","Arg":""}],"X":1,"Y":4},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In","Ix":15,"Type":"ANY","Var":"TCPAccept.ErrorID"}],"Ix":38,"Name":"MOVE","Out":[{"__type":"PF","Arg":"ENO"},{"__type":"PRM","Arg":"Out","Ix":16,"Type":"ANY","Var":"ErrorID"}],"X":2,"Y":4},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In1","Ix":13,"Type":"ANY_ELEMENTARY, ENUM","Var":"TCPStatus.ErrorID"},{"__type":"PRM","Arg":"In2","Ix":14,"Type":"ANY_ELEMENTARY, ENUM","Var":"WORD#0"}],"Ix":37,"Name":"<>","Out":[{"__type":"PF","Arg":""}],"X":1,"Y":5},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In","Ix":17,"Type":"ANY","Var":"TCPStatus.ErrorID"}],"Ix":39,"Name":"MOVE","Out":[{"__type":"PF","Arg":"ENO"},{"__type":"PRM","Arg":"Out","Ix":18,"Type":"ANY","Var":"ErrorID"}],"X":2,"Y":5},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In1","Ix":19,"Type":"ANY_ELEMENTARY, ENUM","Var":"TCPClearBuffer.ErrorID"},{"__type":"PRM","Arg":"In2","Ix":20,"Type":"ANY_ELEMENTARY, ENUM","Var":"WORD#0"}],"Ix":40,"Name":"<>","Out":[{"__type":"PF","Arg":""}],"X":1,"Y":6},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In","Ix":21,"Type":"ANY","Var":"TCPClearBuffer.ErrorID"}],"Ix":41,"Name":"MOVE","Out":[{"__type":"PF","Arg":"ENO"},{"__type":"PRM","Arg":"Out","Ix":22,"Type":"ANY","Var":"ErrorID"}],"X":2,"Y":6},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In1","Ix":23,"Type":"ANY_ELEMENTARY, ENUM","Var":"TCPReceive.ErrorID"},{"__type":"PRM","Arg":"In2","Ix":24,"Type":"ANY_ELEMENTARY, ENUM","Var":"WORD#0"}],"Ix":42,"Name":"<>","Out":[{"__type":"PF","Arg":""}],"X":1,"Y":7},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In","Ix":25,"Type":"ANY","Var":"TCPReceive.ErrorID"}],"Ix":43,"Name":"MOVE","Out":[{"__type":"PF","Arg":"ENO"},{"__type":"PRM","Arg":"Out","Ix":26,"Type":"ANY","Var":"ErrorID"}],"X":2,"Y":7},{"__type":"HL","X":2}],"LRI":46,"RRI":47,"VLs":[{"Ix":48,"X":1},{"Ix":48,"X":1,"Y":1},{"Ix":48,"X":1,"Y":2},{"Ix":48,"X":1,"Y":3},{"Ix":48,"X":1,"Y":4},{"Ix":48,"X":1,"Y":5},{"Ix":48,"X":1,"Y":6}]}
