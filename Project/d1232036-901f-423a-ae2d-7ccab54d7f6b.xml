<StructuredTextModel xmlns="http://schemas.datacontract.org/2004/07/Omron.Cxap.Modules.StructuredText.Core" xmlns:i="http://www.w3.org/2001/XMLSchema-instance"><Text>//------------------&#xD;
//Omron Electronics Norway AS&#xD;
//Mantas Simkus / IAB&#xD;
//------------------&#xD;
&#xD;
//------------------&#xD;
//	13.03.2020 - reset run_rw when acitvating run_fw and opposite. To avoid fwd and rev command to be active at same time. .&#xD;
//&#xD;
//------------------&#xD;
&#xD;
&#xD;
exe_trig(Clk:=Execute);&#xD;
&#xD;
&#xD;
//INIT&#xD;
IF exe_trig.Q THEN&#xD;
	Done:=FALSE;&#xD;
	Deviation:=0;&#xD;
	DecelerationStore:=Deceleration;			//store initial deceleration value..&#xD;
	Speed:=SpeedSetpoint;							//start moving at setpoint speed&#xD;
	SpeedReductionStarted:=FALSE;	&#xD;
	IF PosActual &lt; PosSetpoint THEN			//set which direction to run&#xD;
		run_fw:=TRUE;&#xD;
		run_rw:=FALSE;&#xD;
	ELSIF PosActual &gt; PosSetpoint THEN&#xD;
		run_rw:=TRUE;&#xD;
		run_fw:=FALSE;&#xD;
	END_IF;&#xD;
END_IF;&#xD;
&#xD;
&#xD;
IF NOT Execute AND Done THEN&#xD;
	PosRemaining:=PosSetpoint- PosActual;&#xD;
END_IF;&#xD;
&#xD;
IF Execute AND NOT Done THEN&#xD;
	IF run_fw THEN&#xD;
		PosRemaining:=PosSetpoint-PosActual;&#xD;
	ELSE&#xD;
		PosRemaining:=PosActual - PosSetpoint;&#xD;
	END_IF;&#xD;
	&#xD;
	IF PosRemaining&lt;Ramp_dist THEN&#xD;
		SpeedReductionStarted:=TRUE;&#xD;
		PositionGain:=PosRemaining/ Ramp_dist;&#xD;
		IF Linear_Square THEN&#xD;
			PositionGain := SQRT (PositionGain);&#xD;
		END_IF;&#xD;
		&#xD;
		Speed:=SpeedSetpoint * PositionGain; //reduce speed proportionally when arriving close to setpoint position; check if ABS could cause a bug&#xD;
		Deceleration:= DecelerationStore * PositionGain; // reduce decelaration proportionally&#xD;
	END_IF;&#xD;
	&#xD;
	IF Speed &lt; SpeedMin THEN		//do not reduce speed bellow minimum speed&#xD;
		Speed:=SpeedMin;&#xD;
	END_IF;&#xD;
	&#xD;
	//IF (PosRemaining &lt;= Stop_dist AND NOT CorrectionAuto) OR (CorrectionAuto AND PosRemaining &lt;= 0.5)  or Stop THEN&#xD;
	IF (PosRemaining &lt;= Stop_dist )  or Stop THEN&#xD;
		&#xD;
		&#xD;
		Done:=TRUE;&#xD;
		run_fw:=FALSE;&#xD;
		run_rw:=FALSE;&#xD;
		Deviation:=PosRemaining;&#xD;
		Deceleration:=DecelerationStore;&#xD;
	END_IF;&#xD;
	&#xD;
END_IF;</Text></StructuredTextModel>